{% extends 'base.html' %}

{% block main %}
<section class="section section--timeline section--timeline-management">
    <h2>Timeline beheer</h2>

    <form method="post" enctype="multipart/form-data" data-decorator="edit-timeline">
        {% csrf_token %}

        {{ moment_form_set.management_form }}
        <!-- {{ moment_form_set.errors }} -->
        <div data-moment-container>
            {% for moment in moment_form_set %}

                <div class="details-wrapper" 
                    data-id="{{ moment.instance.id }}" 
                    data-order="{{ moment.instance.order }}" 
                    data-moment-order="{{ moment.instance.order }}"
                    data-moment 
                    data-mode="static">

                    <div class="dot dot--large"></div>
                    <details class="details">
                        <summary class="details__header">
                            <h3 class="details__title">{{ moment.instance.name }}</h3>
                            <span class="details__toggle-icon">
                                <svg class="details__header-opened" width="14" height="9">
                                    <use href="#chevron-up" xlink:href="#chevron-up" width="14" height="9" />
                                </svg>
                                <svg class="details__header-closed" width="14" height="9">
                                    <use href="#chevron-down" xlink:href="#chevron-up" width="14" height="9" />
                                </svg>
                            </span>
                            
                            <div class="change-order">
                                <button class="button button--icon" data-handler="moment-up"><svg width="14" height="9">
                                    <use href="#chevron-up" xlink:href="#chevron-up" width="14" height="9" />
                                </svg></button>
                                <button class="button button--icon" data-handler="moment-down"><svg  width="14" height="9">
                                    <use href="#chevron-down" xlink:href="#chevron-up" width="14" height="9" />
                                </svg></button>
                                <button class="button button--icon" data-handler="delete-moment"><svg width="12" height="14">
                                    <use href="#trash" xlink:href="#chevron-up" width="12" height="14" />
                                </svg></button>
                            </div>
                        </summary>

                        <div class="details__content">
                            <p>{{ moment.instance.description }}</p>

                            <p><a href="#edit--{{ moment.instance.id }}">Pas deze stap aan</a></p>
 
                            {% if moment.instance.documents.all %}
                                <p>{{ moment.instance.documents.all|length }} document(en)</p>
                            {% endif %}  
                        </div>

                        <div class="details__headerhoverblock"></div>

                        <fieldset class="details__editform" data-decorator="edit-moment" id="edit--{{ moment.instance.id }}">
                            <h4>Stap aanpassen</h4>

                            <div class="form-field">
                                {{ moment.name.label_tag }}
                                <p class="help-text">
                                    (Naam)
                                </p>
                                {{ moment.name }}
                            </div>

                            <div class="form-field">
                                {{ moment.description.label_tag }}
                                <p class="help-text">
                                    (Beschrijving)
                                </p>
                                {{ moment.description }}
                            </div>

                            <div class="form-field">
                                <button class="button button--primary" data-handler="save-moment">Opslaan</button>
                            </div>
                        </fieldset>
                    </details>

                    <button class="new-moment__add" data-handler="new-moment" title="Voeg hier een processtap toe">
                        <div class="new-moment__line"></div>
                        <div class="button button--icon">
                            <svg class="details__header-closed" width="16" height="16">
                                <title>Voeg stap toe</title>
                                <use href="#add-document" xlink:href="#add-document" width="16" height="16" />
                            </svg>
                        </div>
                    </button>
                </div> 
            {% endfor %}
        </div>
        
        <div class="details-wrapper details-wrapper--new-moment" data-moment data-moment-proto style="display: none">
        <fieldset >
            <h2>Nieuw timeline moment</h2>
            <div class="form-field">
                {{ form.name.label_tag }}
                {{ form.name }}
            </div>

            <div class="form-field">
                {{ moment.description.label_tag }}
                {{ form.description }}
            </div>

            <div class="form-field form-field--buttons">
                <button class="button button--primary" data-handler="save-moment">Opslaan</button>
                <button class="button button--secondary" data-handler="exit-new-moment">Annuleer</button>
            </div>
        </fieldset></div>

{#        <div class="form-field form-field--buttons">#}
{#            <input type="submit" value="Opslaan" class="button button--primary">#}
{#            <a href="{% url 'home' %}" class="button button--secondary">Annuleer</a>#}
{#        </div>#}

    </form>
</section>
{% endblock %}
